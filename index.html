<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>zzy - 学号点名</title>
    <link rel="stylesheet" href="weui-master/dist/style/weui.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        /* 轻量兜底，主样式在 assets/css/style.css */
        .hidden { display: none; }
    </style>
    <script defer src="assets/js/app.js"></script>
    <script>
        // 简单防抖，避免 iOS PWA 双击放大
        document.addEventListener('gesturestart', function (e) { e.preventDefault(); });
    </script>
    <link rel="icon" href="weui-master/dist/example/images/logo.png">
    <meta name="theme-color" content="#12b76a">
</head>
<body data-weui-theme="light">
    <div class="app">
        <header class="app__header">
            <div class="app__brand">
                <span class="brand__logo">🎯</span>
                <h1 class="brand__title">学号随机点名</h1>
                <div class="brand__profile">
                    <span class="profile__label">班级：</span>
                    <select id="profileSelect" class="weui-select weui-select_in-header"></select>
                </div>
            </div>
            <button id="btnOpenSettings" class="weui-btn weui-btn_default app__settings-btn" aria-label="打开设置">设置</button>
        </header>

        <main class="app__main">
            <section class="card card--panel">
                <div id="rangeBar" class="range-grid">
                    <div class="range-item">
                        <label for="inputMin" class="weui-label">最小学号</label>
                        <input id="inputMin" type="number" class="weui-input" placeholder="如 1" min="-999999">
                    </div>
                    <div class="range-item">
                        <label for="inputMax" class="weui-label">最大学号</label>
                        <input id="inputMax" type="number" class="weui-input" placeholder="如 50" min="-999999">
                    </div>
                    <div class="range-item">
                        <label for="inputExclude" class="weui-label">排除学号</label>
                        <input id="inputExclude" type="text" class="weui-input" placeholder="如 4, 13, 37">
                    </div>
                </div>

                

                <div class="display">
                    <div id="displayLabel" class="display__label">当前学号</div>
                    <div id="displayNumber" class="display__number">—</div>
                    <div id="displayName" class="display__name hidden">—</div>
                    <div id="displayCountdown" class="display__countdown hidden">—</div>
                </div>

                <div class="controls controls--bottom">
                    <div class="controls__primary">
                        <button class="weui-btn weui-btn_primary btn-ripple js-ripple js-start">开始滚动</button>
                        <button class="weui-btn weui-btn_warn btn-ripple js-ripple js-stop hidden">停止并点名</button>
                    </div>
                    <button id="btnAuto5s" class="weui-btn weui-btn_default btn-ripple js-ripple">5秒随机抽人</button>
                </div>
            </section>

            
        </main>

        <footer class="app__footer">
            <div class="app__actions">
                <button id="btnToggleTheme" class="weui-btn weui-btn_default weui-btn_mini btn-ripple js-ripple">切换主题</button>
                <button id="btnWhatsNew" class="weui-btn weui-btn_default weui-btn_mini btn-ripple js-ripple">新功能</button>
            </div>
            <div class="app__meta">
                <span>基于 Cursor AI 技术(HTML5+CSS3+JavaScript)</span>
                <span class="dot">·</span>
                <span>浏览器：<span id="browserInfo">-</span></span>
                <span class="dot">·</span>
                <span>版本：v3.0.3</span>
                <span class="dot">·</span>
                <span>台州王浩哥集团有限公司 © 2025</span>
                <span class="dot">·</span>
                <span>赠送:詹珍怡及其所有朋友(请认准:<a href="https://zhanzhenyi.cn" target="_blank" style="color: darkgreen;">zhanzhenyi.cn</a>)</span>
            </div>
        </footer>
    </div>

    <!-- 设置弹窗 -->
    <div id="settingsSheet" class="weui-mask hidden" role="dialog" aria-modal="true">
        <div class="sheet">
            <div class="sheet__header">高级设置<button id="btnSettingsClose" class="sheet__close" aria-label="关闭" style="color: red;">×</button></div>
            <div class="sheet__content">
                <div class="weui-cells__title">班级配置</div>
                <div class="weui-cell">
                    <div class="weui-cell__bd">
                        <select id="profileSelectSettings" class="weui-select"></select>
                    </div>
                    <div class="weui-cell__ft" style="white-space: nowrap;">
                        <button id="btnProfileNew" class="weui-btn weui-btn_mini weui-btn_default">新建</button>
                        <button id="btnProfileRename" class="weui-btn weui-btn_mini weui-btn_default" style="margin-left:8px;">重命名</button>
                        <button id="btnProfileDelete" class="weui-btn weui-btn_mini weui-btn_warn" style="margin-left:8px;">删除</button>
                    </div>
                </div>
                <div class="weui-cell">
                    <div class="weui-cell__bd">导入/导出</div>
                    <div class="weui-cell__ft" style="white-space: nowrap;">
                        <button id="btnProfileExport" class="weui-btn weui-btn_mini weui-btn_default">导出当前班级</button>
                        <button id="btnProfileImport" class="weui-btn weui-btn_mini weui-btn_default" style="margin-left:8px;">导入班级</button>
                        <input id="inputImportProfile" type="file" accept="application/json" class="hidden">
                    </div>
                </div>
                <label class="weui-cell weui-cell_switch">
                    <div class="weui-cell__bd">不重复点到（抽过不再出现）</div>
                    <div class="weui-cell__ft">
                        <input id="switchNoRepeat" class="weui-switch" type="checkbox" checked>
                    </div>
                </label>
                <label class="weui-cell">
                    <div class="weui-cell__bd">何时清空不重复名单？</div>
                    <div class="weui-cell__ft">
                        <select id="selectNoRepeatExpire" class="weui-select">
                            <option value="session" selected>网页刷新后</option>
                            <option value="40m">40分钟后</option>
                            <option value="1d">一天后</option>
                        </select>
                    </div>
                </label>
                <label class="weui-cell weui-cell_switch">
                    <div class="weui-cell__bd">启用滚动动画（更有仪式感）</div>
                    <div class="weui-cell__ft">
                        <input id="switchAnimate" class="weui-switch" type="checkbox" checked>
                    </div>
                </label>

                <label class="weui-cell weui-cell_switch">
                    <div class="weui-cell__bd">显示顶部设置栏</div>
                    <div class="weui-cell__ft">
                        <input id="switchShowRangeBar" class="weui-switch" type="checkbox" checked>
                    </div>
                </label>

                <div class="weui-cell">
                    <div class="weui-cell__bd">
                        <label for="inputAutoSeconds" class="weui-label">自动抽人时长</label>
                        <input id="inputAutoSeconds" type="range" min="1" max="10" value="5" style="width:100%">
                        <div style="margin-top:6px;color:#5b776f;">当前：<span id="autoSecondsPreview">5</span> 秒</div>
                    </div>
                </div>

                <div class="weui-cell">
                    <div class="weui-cell__bd">自定义名单</div>
                    <div class="weui-cell__ft">
                        <button id="btnOpenRoster" class="weui-btn weui-btn_mini weui-btn_default">打开</button>
                    </div>
                </div>

                <div class="weui-cells__title">高级抽取策略</div>
                <label class="weui-cell weui-cell_switch">
                    <div class="weui-cell__bd">启用概率权重(可以设置每个学号抽中的概率)</div>
                    <div class="weui-cell__ft">
                        <input id="switchEnableWeights" class="weui-switch" type="checkbox">
                    </div>
                </label>
                <div class="weui-cell">
                    <div class="weui-cell__bd">概率权重设置（按范围配置百分比）</div>
                    <div class="weui-cell__ft">
                        <button id="btnOpenWeights" class="weui-btn weui-btn_mini weui-btn_default">打开</button>
                    </div>
                </div>
            </div>
            <div class="sheet__footer">
                <button id="btnSettingsCancel" class="weui-btn weui-btn_default">取消</button>
                <button id="btnClearPicked" class="weui-btn weui-btn_warn">清空已抽</button>
                <button id="btnSettingsSave" class="weui-btn weui-btn_primary">保存</button>
            </div>
        </div>
    </div>

    <!-- 新功能弹窗 -->
    <div id="whatsNewSheet" class="weui-mask hidden" role="dialog" aria-modal="true" style="z-index: 999999999;">
        <div class="sheet">
            <div class="sheet__header">新功能<button id="btnWhatsNewClose" class="sheet__close" aria-label="关闭">×</button></div>
            <div class="sheet__content">
                <div class="weui-cells__title">当前版本：v3.0.3</div>
                <div class="weui-cells">
                    <div class="weui-cell">新增：按学号设置抽取百分比（支持添加学号组）</div>
                    <div class="weui-cell">新增：概率权重独立设置页，开启后加权抽取</div>
                    <div class="weui-cell">新增：自定义名单移动到独立设置页</div>
                    <div class="weui-cell">优化：所有输入框样式统一，浅色下边框更明显</div>
                    <div class="weui-cell">优化：设置页右上角关闭按钮置顶不随滚动消失</div>
                    <div class="weui-cell">修复：权重列表新增学号立刻生效（无需重启）</div>
                    <div class="weui-cell">修复：非法输入即时提示（学号/百分比/学号组）</div>
                    <div class="weui-cell">新增：班级配置页，支持新建、重命名、删除、导入、导出班级</div>
                    <div class="weui-cell">2025年9月11日  更新</div>
                </div>
            </div>
            <div class="sheet__footer">
                <button id="btnWhatsNewOk" class="weui-btn weui-btn_primary">知道了</button>
            </div>
        </div>
    </div>

    <!-- 概率权重设置弹窗 -->
    <div id="weightsSheet" class="weui-mask hidden" role="dialog" aria-modal="true">
        <div class="sheet">
            <div class="sheet__header">概率权重设置（按学号）<button id="btnWeightsClose" class="sheet__close" aria-label="关闭">×</button></div>
            <div class="sheet__content">
                <div class="weui-cells__title">为单个学号设置抽中百分比（未设置者平均分配剩余百分比）。</div>
                <div class="weui-cells__tips" style="margin:6px 0;color:#5b776f;">提示：当前范围与排除条件内的学号，已设置的百分比合计建议不超过 100%；超过时，将仅在已设置学号间按占比抽取。</div>

                <div class="weui-cells" id="weightsList"></div>

                <div class="weui-cell">
                    <div class="weui-cell__bd">
                        <button id="btnWeightsAddId" class="weui-btn weui-btn_default weui-btn_mini">添加学号</button>
                        <button id="btnWeightsAddGroup" class="weui-btn weui-btn_default weui-btn_mini" style="margin-left:8px;">添加学号组</button>
                        <button id="btnWeightsClear" class="weui-btn weui-btn_warn weui-btn_mini" style="margin-left:8px;">清空</button>
                    </div>
                    <div class="weui-cell__ft" style="white-space:nowrap;">当前范围内已分配：<span id="weightsTotal">0%</span></div>
                </div>
            </div>
            <div class="sheet__footer">
                <button id="btnWeightsCancel" class="weui-btn weui-btn_default">取消</button>
                <button id="btnWeightsSave" class="weui-btn weui-btn_primary">保存</button>
            </div>
        </div>
    </div>

    <!-- 自定义名单设置弹窗 -->
    <div id="rosterSheet" class="weui-mask hidden" role="dialog" aria-modal="true">
        <div class="sheet">
            <div class="sheet__header">自定义名单<button id="btnRosterClose" class="sheet__close" aria-label="关闭">×</button></div>
            <div class="sheet__content">
                <div class="weui-cells__title">格式：学号+空格+姓名，一行一个</div>
                <div class="weui-cells">
                    <div class="weui-cell">
                        <div class="weui-cell__bd">
                            <textarea id="textareaRoster" class="weui-textarea" placeholder="例如：\n1 张三\n2 李四\n3 王五" rows="10"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sheet__footer">
                <button id="btnRosterCancel" class="weui-btn weui-btn_default">取消</button>
                <button id="btnRosterClear" class="weui-btn weui-btn_warn">清空</button>
                <button id="btnRosterSave" class="weui-btn weui-btn_primary">保存</button>
            </div>
        </div>
    </div>

</body>
</html>

